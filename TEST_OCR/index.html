<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Club Activity</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playwrite+Australia+NSW&family=Orbitron:wght@400;700&display=swap');

    * { margin:0; padding:0; box-sizing:border-box; }
    body{
      font-family: 'Orbitron', sans-serif;
      color:white;
      min-height:100vh;
      overflow-x:hidden;
      background: black;
    }

    /* Background video */
    #background-video{
      position:fixed;
      right:0;
      bottom:0;
      min-width:110%;
      min-height:110%;
      z-index:-2;
      object-fit:cover;
      transition: opacity 0.7s ease-in-out, filter 0.7s ease-in-out, transform 0.5s ease-out;
      pointer-events:none;
    }
    #background-video.blur-out { filter: blur(8px); opacity: 0; }
    #background-video.blur-in  { filter: blur(8px); opacity: 1; }
    #background-video.no-blur   { filter: blur(0); }

    /* Global text shadow + static glow on hover */
    h1,h2,h3,p,nav a,button {
      text-shadow: 0 0 6px black, 0 0 12px rgba(0,0,0,0.5);
      transition: transform .28s ease, text-shadow .28s ease;
    }
    h1:hover,h2:hover,h3:hover,p:hover,nav a:hover,button:hover{
      transform: scale(1.05);
      text-shadow: 0 0 8px white, 0 0 15px rgba(255,255,255,0.7);
    }

    /* Fixed navigation */
    nav{
      position:fixed;
      top:20px;
      left:50%;
      transform:translateX(-50%);
      background-color: rgba(0,0,0,0.4);
      padding:10px 20px;
      border-radius:8px;
      z-index:12;
      display:flex;
      gap:20px;
      align-items:center;
    }
    nav a { color:white; text-decoration:none; font-size:1.1rem; }

    /* Play music button */
    .audio-btn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 12;
      background-color: rgba(0,0,0,0.5);
      color: white;
      border: 1px solid white;
      border-radius: 5px;
      padding: 10px 15px;
      cursor: pointer;
    }
    .audio-btn:hover{ background-color: rgba(255,255,255,0.12); }

    /* Header / HOME */
    header { padding-top:80px; text-align:center; z-index:6; position:relative; }
    h1 { font-size:3em; text-shadow: 0 0 10px #000, 0 0 15px #222; }
    /* Make HOME quote more visible */
    header p {
      font-size: 1.3em;
      background-color: rgba(0,0,0,0.5);
      padding: 10px 15px;
      border-radius: 8px;
      display: inline-block;
      margin-top: 10px;
    }

    /* Quote small screens tweak */
    @media (max-width:520px){
      header p { font-size: 1em; padding:8px 10px; }
      h1 { font-size:2rem; }
    }

    /* TEAM section */
    #team {
      padding: 100px 20px;
      background-color: rgba(0,0,0,0.6);
      text-align:center;
      min-height:100vh;
      display:none;
      opacity:0;
      transform: translateY(30px);
      transition: opacity 1s ease, transform 1s ease;
      z-index:6;
      position:relative;
    }
    #team.visible { display:block; opacity:1; transform: translateY(0); }

    /* TEAM grid with CREATOR center - 3x3 */
    .team-grid {
      display:grid;
      grid-template-columns: repeat(3, 240px);
      grid-template-rows: repeat(3, 240px);
      gap: 25px;
      justify-content:center;
      margin-top:40px;
    }
    .team-member {
      width:220px;
      height:200px;
      background: rgba(255,255,255,0.08);
      border-radius:8px;
      padding:10px;
      text-align:center;
      opacity:0;
      transform: translateY(20px);
      transition: opacity .8s ease, transform .8s ease, box-shadow .28s ease;
      text-shadow:0 0 6px black;
    }
    .team-member img {
      width:120px;
      height:120px;
      object-fit: cover;
      border-radius:50%;
      margin-top:5px;
    }
    /* role-specific borders for images */
    .President img      { border:3px solid gold; }
    .VicePresident img  { border:3px solid lightblue; }
    .Secretary img      { border:3px solid violet; }
    .Treasurer img      { border:3px solid orange; }
    .Coordinator img    { border:3px solid lime; }
    .Designer img       { border:3px solid deeppink; }
    .Developer img      { border:3px solid cyan; }
    .Marketing img      { border:3px solid yellow; }
    .Creator img        { border:3px solid red; }

    .team-member h3 { font-size:1em; margin:6px 0 0 0; }
    .team-member p  { font-size:.9em; color:#ddd; margin:0; }
    .team-member.show { opacity:1; transform: translateY(0); }

    /* hover glows for team roles */
    .President:hover      { box-shadow: 0 0 14px gold; transform: translateY(-5px) scale(1.02); }
    .VicePresident:hover  { box-shadow: 0 0 14px lightblue; transform: translateY(-5px) scale(1.02); }
    .Secretary:hover      { box-shadow: 0 0 14px violet; transform: translateY(-5px) scale(1.02); }
    .Treasurer:hover      { box-shadow: 0 0 14px orange; transform: translateY(-5px) scale(1.02); }
    .Coordinator:hover    { box-shadow: 0 0 14px lime; transform: translateY(-5px) scale(1.02); }
    .Designer:hover       { box-shadow: 0 0 14px deeppink; transform: translateY(-5px) scale(1.02); }
    .Developer:hover      { box-shadow: 0 0 14px cyan; transform: translateY(-5px) scale(1.02); }
    .Marketing:hover      { box-shadow: 0 0 14px yellow; transform: translateY(-5px) scale(1.02); }
    .Creator:hover        { box-shadow: 0 0 20px red, 0 0 40px red; transform: translateY(-5px) scale(1.03); }

    /* EVENTS section */
    #events {
      padding: 80px 20px;
      background-color: rgba(0,0,0,0.6);
      text-align:center;
      min-height:100vh;
      display:none;
      opacity:0;
      transform: translateY(30px);
      transition: opacity 1s ease, transform 1s ease;
      z-index:6;
      position:relative;
    }
    #events.visible { display:block; opacity:1; transform: translateY(0); }

    .events-header { display:flex; gap:12px; justify-content:center; align-items:center; margin-top:6px; }
    .events-controls { margin-top:18px; display:flex; gap:12px; justify-content:center; }

    /* events grid */
    .events-grid {
      display:flex;
      gap:18px;
      justify-content:center;
      margin-top:24px;
      flex-wrap:wrap;
      max-width:900px;
      margin-left:auto;
      margin-right:auto;
    }
    .event-card {
      width: 300px;
      min-height:220px;
      background: rgba(255,255,255,0.06);
      border-radius:10px;
      padding:12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      transition: transform .28s ease, box-shadow .28s ease;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:flex-start;
    }
    .event-card:hover { transform: scale(1.03); cursor:pointer; }
    .event-thumb {
      width:100%;
      height:120px;
      border-radius:8px;
      object-fit:cover;
      background:#222;
    }
    .event-meta { font-size:.95rem; color:#eee; text-shadow:0 0 6px black; }
    .event-points { margin-left:12px; color:#ddd; font-size:.9rem; }
    .empty-msg { margin-top:20px; color:#ccc; text-shadow:0 0 6px black; }

    /* ADD EVENT subsection (frosted slide-down) */
    .add-event-area {
      max-width:760px;
      margin:18px auto 0 auto;
      background: rgba(255,255,255,0.04);
      border-radius:12px;
      padding:14px;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      transform-origin: top;
      transition: max-height .45s ease, opacity .45s ease, transform .45s ease;
      overflow:hidden;
    }
    .add-event-area.hidden { max-height:0; opacity:0; transform: translateY(-8px); padding:0 14px; }
    .add-event-area.visible { max-height:600px; opacity:1; transform: translateY(0); }

    .field-row { display:flex; gap:12px; margin-top:10px; flex-wrap:wrap; }
    .field {
      flex:1 1 220px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .field input[type="text"], .field input[type="file"], .field textarea {
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.08);
      padding:8px 10px;
      border-radius:6px;
      outline:none;
    }
    .field input[type="text"]:focus, .field textarea:focus {
      box-shadow: 0 0 8px rgba(255,255,255,0.12);
      border-color: rgba(255,255,255,0.18);
    }
    .small-note { font-size:.85rem; color:#ccc; }

    .form-actions { display:flex; gap:12px; justify-content:flex-end; margin-top:12px; }

    /* Clear/Add button styles */
    .btn {
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      color: white;
      padding:8px 12px;
      border-radius:6px;
      cursor:pointer;
      transition: transform .18s ease, background .18s;
    }
    .btn:hover { transform: translateY(-3px); background: rgba(255,255,255,0.10); }
    .btn.primary { background: linear-gradient(90deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02)); border-color: rgba(255,255,255,0.16); }

    /* small responsive fixes */
    @media (max-width:860px){
      .team-grid { grid-template-columns: repeat(3, 200px); grid-template-rows: repeat(3,200px); gap:16px; }
      .team-member{ width:180px; height:170px; }
      .team-member img{ width:100px; height:100px; }
      .events-grid { gap:12px; }
      .event-card { width: 260px; }
    }

  </style>
</head>
<body>
  <!-- Background video (single element reused & swapped) -->
  <video id="background-video" autoplay muted>
    <source src="BLHOLE.mp4" type="video/mp4">
    Your browser doesn't support video.
  </video>

  <!-- Navigation -->
  <nav>
    <a href="#" id="home-link">HOME</a>
    <a href="#team" id="team-link">TEAM</a>
    <a href="#events" id="events-link">EVENTS</a>
  </nav>

  <!-- Audio -->
  <audio id="bg-audio" preload="auto" loop>
    <source src="ÔºÆÔºØÔº≥Ôº¥Ôº°Ôº¨ÔºßÔº©Ôº°.mp3" type="audio/mpeg">
  </audio>
  <button class="audio-btn" id="audio-toggle">Play Music</button>

  <!-- HOME -->
  <header>
    <h1>WELCOME USER</h1>
    <p>"Within the darkness of the void, I forge my own light.‚Äù</p>
  </header>

  <!-- TEAM -->
  <section id="team">
    <h2>Our Team</h2>
    <p>Meet the amazing people behind our club activities.</p>
    <div class="team-grid">
      
    <div class="team-member President"><img src="M1.jpg"><h3> DISHAANüêäüí®</h3><p>President</p></div>
      <div class="team-member VicePresident"><img src="M2.jpg"><h3>VIHAS</h3><p>Vice President</p></div>
      <div class="team-member Secretary"><img src="M3.jpg"><h3>VIJEETH</h3><p>Secretary</p></div>
      <div class="team-member Treasurer"><img src="M4.jpg"><h3>MEGHANA</h3><p>Treasurer</p></div>

      <div class="team-member Creator"><img src="M9.jpg"><h3>AFK</h3><p>Creator</p></div>

      <div class="team-member Coordinator"><img src="M5.jpg"><h3>SHRINIDHI</h3><p>Coordinator</p></div>
      <div class="team-member Designer"><img src="M6.jpg"><h3>MEDHA.S.NAYAK</h3><p>Designer</p></div>
      <div class="team-member Developer"><img src="M7.jpg"><h3>MUWAZ</h3><p>Developer</p></div>
      <div class="team-member Marketing"><img src="M8.jpg"><h3>RISHITH</h3><p>Marketing</p></div>

    </div>
  </section>

  <!-- EVENTS -->
  <section id="events">
    <h2>Upcoming Events</h2>
    <p class="small-note">Events you add will persist until you clear them.</p>

    <div class="events-grid" id="events-grid">
      <!-- Cards added dynamically -->
    </div>

    <div class="empty-msg" id="events-empty">No upcoming events yet.</div>

    <div class="events-controls">
      <button class="btn primary" id="add-event-btn">ADD EVENT</button>
      <button class="btn" id="clear-events-btn">CLEAR EVENTS</button>
    </div>

    <!-- ADD EVENT slide-down subsection (hidden initially) -->
    <div class="add-event-area hidden" id="add-event-area">
      <h3 style="text-align:left;">Add an Event</h3>

      <div class="field-row">
        <div class="field">
          <label class="small-note">Event Image</label>
          <input type="file" accept="image/*" id="event-image-input">
        </div>

        <div class="field">
          <label class="small-note">Date & Time / Duration</label>
          <input type="text" id="event-datetime" placeholder="e.g. 2025-08-20 ‚Ä¢ 6:00pm - 8:00pm">
        </div>
      </div>

      <div class="field-row">
        <div class="field">
          <label class="small-note">Point 1</label>
          <input type="text" id="event-p1" placeholder="Short description point 1">
        </div>
        <div class="field">
          <label class="small-note">Point 2</label>
          <input type="text" id="event-p2" placeholder="Short description point 2">
        </div>
        <div class="field">
          <label class="small-note">Point 3</label>
          <input type="text" id="event-p3" placeholder="Short description point 3">
        </div>
      </div>

      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px;">
        <button class="btn" id="cancel-add-btn">Cancel</button>
        <button class="btn primary" id="save-event-btn">Save Event</button>
      </div>

      <div id="add-preview" style="margin-top:12px; display:none;">
        <p class="small-note">Preview:</p>
        <img id="preview-img" src="" alt="preview" style="width:180px;height:110px;object-fit:cover;border-radius:8px;">
      </div>
    </div>
  </section>

  <script>
    /***********************
     * Core DOM references *
     ***********************/
    const bgAudio = document.getElementById('bg-audio');
    const audioToggle = document.getElementById('audio-toggle');
    const video = document.getElementById('background-video');

    const homeLink = document.getElementById('home-link');
    const teamLink = document.getElementById('team-link');
    const eventsLink = document.getElementById('events-link');

    const teamSection = document.getElementById('team');
    const eventsSection = document.getElementById('events');

    const teamMembers = document.querySelectorAll('.team-member');

    // Events UI
    const eventsGrid = document.getElementById('events-grid');
    const eventsEmpty = document.getElementById('events-empty');
    const addEventBtn = document.getElementById('add-event-btn');
    const clearEventsBtn = document.getElementById('clear-events-btn');
    const addArea = document.getElementById('add-event-area');
    const cancelAddBtn = document.getElementById('cancel-add-btn');
    const saveEventBtn = document.getElementById('save-event-btn');
    const eventImageInput = document.getElementById('event-image-input');
    const eventDatetimeInput = document.getElementById('event-datetime');
    const eventP1 = document.getElementById('event-p1');
    const eventP2 = document.getElementById('event-p2');
    const eventP3 = document.getElementById('event-p3');
    const addPreview = document.getElementById('add-preview');
    const previewImg = document.getElementById('preview-img');

    /***************************
     * Audio / small utilities *
     ***************************/
    let isPlaying = false;
    audioToggle.addEventListener('click', () => {
      if (!isPlaying) {
        bgAudio.play().then(()=>{ isPlaying = true; audioToggle.textContent = 'Mute Music'; }).catch(()=>{});
      } else {
        bgAudio.pause();
        isPlaying = false;
        audioToggle.textContent = 'Play Music';
      }
    });
    // autoplay on first move (tries)
    document.addEventListener('mousemove', function firstMove(){
      if (!isPlaying) {
        bgAudio.play().then(()=>{ isPlaying = true; audioToggle.textContent = 'Mute Music'; }).catch(()=>{});
      }
      document.removeEventListener('mousemove', firstMove);
    });

    // parallax small translate for video
    document.addEventListener('mousemove', (e) => {
      let x = (e.clientX / window.innerWidth - 0.5) * 5;
      let y = (e.clientY / window.innerHeight - 0.5) * 5;
      video.style.transform = `translate(${x}px, ${y}px) scale(1.03)`;
    });

    /******************************
     * Video switching + boomerang
     ******************************/
    let boomerangInterval = null;
    let playingForward = true;

    function changeVideoSmooth(newSrc, boomerang=false){
      // clear any boomerang loop
      if (boomerangInterval) { clearInterval(boomerangInterval); boomerangInterval = null; }
      // progressive blur + fade
      video.classList.add('blur-out');
      setTimeout(() => {
        // swap source
        const source = video.querySelector('source');
        source.src = newSrc;
        video.load();
        video.play().catch(()=>{});
        // if boomerang => use manual reverse playing method
        if (boomerang){
          // reset state
          playingForward = true;
          // watch for approaching end and reverse
          boomerangInterval = setInterval(() => {
            if (playingForward && video.duration && video.currentTime >= video.duration - 0.04){
              playingForward = false;
              video.pause();
              reversePlay();
            }
          }, 50);
        } else {
          video.loop = true;
        }
        // blur-in then remove blur
        video.classList.remove('blur-out');
        video.classList.add('blur-in');
        setTimeout(() => {
          video.classList.remove('blur-in');
          video.classList.add('no-blur');
        }, 500);
      }, 700);
    }

    function reversePlay(){
      // step backwards at roughly 30fps speed (matching forward playback)
      let reverseStep = setInterval(() => {
        if (video.currentTime <= 0.05){
          clearInterval(reverseStep);
          playingForward = true;
          video.play().catch(()=>{});
        } else {
          video.currentTime = Math.max(0, video.currentTime - 0.033);
        }
      }, 33);
    }

    /******************************
     * Section navigation behavior
     ******************************/
    // show only HOME on load
    function showHomeOnLoad() {
      // ensure home visible, others hidden
      teamSection.classList.remove('visible'); teamSection.style.display='none';
      eventsSection.classList.remove('visible'); eventsSection.style.display='none';
      // ensure background is home video
      changeVideoSmooth('BLHOLE.mp4', false);
      window.scrollTo({ top:0, behavior:'instant' });
    }
    // call on load
    showHomeOnLoad();

    teamLink.addEventListener('click', (e) => {
      e.preventDefault();
      // show team section, hide others
      eventsSection.classList.remove('visible'); eventsSection.style.display='none';
      teamSection.style.display = 'block';
      setTimeout(()=> teamSection.classList.add('visible'), 10);
      // change video to team boomerang
      changeVideoSmooth('PIN.mp4', true);
      teamSection.scrollIntoView({ behavior: 'smooth' });
    });

    homeLink.addEventListener('click', (e) => {
      e.preventDefault();
      // hide others
      teamSection.classList.remove('visible'); setTimeout(()=>teamSection.style.display='none',500);
      eventsSection.classList.remove('visible'); setTimeout(()=>eventsSection.style.display='none',500);
      // switch back to home
      changeVideoSmooth('BLHOLE.mp4', false);
      window.scrollTo({ top:0, behavior:'smooth' });
    });

    eventsLink.addEventListener('click', (e) => {
      e.preventDefault();
      // hide team, show events
      teamSection.classList.remove('visible'); setTimeout(()=>teamSection.style.display='none',500);
      eventsSection.style.display = 'block';
      setTimeout(()=> eventsSection.classList.add('visible'), 10);
      // switch background to EVE.mp4 (normal loop)
      changeVideoSmooth('EVE.mp4', false);
      eventsSection.scrollIntoView({ behavior: 'smooth' });
      renderEvents(); // ensure events shown/up-to-date
    });

    /***********************
     * TEAM reveal helpers
     ***********************/
    // Show team member boxes staggered when team visible
    function revealTeamMembers(){
      teamMembers.forEach((m,i) => {
        setTimeout(()=> m.classList.add('show'), i*140);
      });
    }
    // Observe team section to reveal members if scrolled into view
    const teamObserver = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting && entry.target.id === 'team'){
          revealTeamMembers();
        }
      });
    }, { threshold: 0.35 });
    teamObserver.observe(teamSection);

    /***************************
     * EVENTS: localStorage API
     ***************************/
    const STORAGE_KEY = 'club_events_v1';

    function readStoredEvents(){
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        return JSON.parse(raw);
      } catch(err){ console.error('events read error',err); return []; }
    }

    function saveStoredEvents(arr){
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
      } catch(err){ console.error('events save error',err); }
    }

    function clearStoredEvents(){
      localStorage.removeItem(STORAGE_KEY);
    }

    /***************************
     * Events UI & rendering
     ***************************/
    const COLOR_PALETTE = ['#ff3860','#ffdd57','#32d296','#7c6cff','#ff7ab6','#00c2ff','#ff8a00','#ffd166'];

    function pickRandomColor(){ return COLOR_PALETTE[Math.floor(Math.random()*COLOR_PALETTE.length)]; }

    function renderEvents(){
      const events = readStoredEvents();
      eventsGrid.innerHTML = '';
      if (!events || events.length === 0){
        eventsEmpty.style.display = 'block';
      } else {
        eventsEmpty.style.display = 'none';
      }

      events.slice(0,3).forEach((ev, idx) => {
        const card = document.createElement('div');
        card.className = 'event-card';
        // apply border/glow color as inline style for consistency
        card.style.border = `2px solid ${ev.color}20`;
        card.style.boxShadow = `0 10px 30px ${ev.color}33`;
        // content
        const img = document.createElement('img');
        img.className = 'event-thumb';
        img.src = ev.image || '';
        img.alt = ev.title || 'Event image';
        // meta + points
        const meta = document.createElement('div');
        meta.className = 'event-meta';
        meta.textContent = ev.datetime || '';
        const points = document.createElement('ul');
        points.className = 'event-points';
        (ev.points || []).forEach(pt => {
          const li = document.createElement('li');
          li.textContent = pt || '';
          points.appendChild(li);
        });

        card.appendChild(img);
        card.appendChild(meta);
        card.appendChild(points);

        // hover-style: change shadow color to a stronger glow on hover
        card.addEventListener('mouseenter', ()=> {
          card.style.boxShadow = `0 18px 48px ${ev.color}66, 0 6px 18px rgba(0,0,0,0.6)`;
          card.style.transform = 'scale(1.035)';
        });
        card.addEventListener('mouseleave', ()=> {
          card.style.boxShadow = `0 10px 30px ${ev.color}33`;
          card.style.transform = '';
        });

        eventsGrid.appendChild(card);
      });

      // update Add button disabled state when 3 events exist
      if (events.length >= 3) {
        addEventBtn.disabled = true;
        addEventBtn.classList.add('disabled');
        addEventBtn.textContent = 'ADD EVENT (max 3)';
      } else {
        addEventBtn.disabled = false;
        addEventBtn.classList.remove('disabled');
        addEventBtn.textContent = 'ADD EVENT';
      }
    }

    // initial render on load
    renderEvents();

    /*************************
     * ADD EVENT interactions
     *************************/
    let currentImageData = null;

    addEventBtn.addEventListener('click', () => {
      // show slide-down form
      if (addArea.classList.contains('visible')){
        // if visible, hide it
        addArea.classList.remove('visible');
        setTimeout(()=> addArea.classList.add('hidden'), 450);
      } else {
        addArea.classList.remove('hidden');
        setTimeout(()=> addArea.classList.add('visible'), 10);
      }
    });

    cancelAddBtn.addEventListener('click', () => {
      hideAddForm();
    });

    function hideAddForm(){
      addArea.classList.remove('visible');
      setTimeout(()=> {
        addArea.classList.add('hidden');
        // clear inputs
        eventImageInput.value = '';
        eventDatetimeInput.value = '';
        eventP1.value = ''; eventP2.value = ''; eventP3.value = '';
        previewImg.src = '';
        addPreview.style.display = 'none';
        currentImageData = null;
      }, 400);
    }

    // Image preview and read as dataURL
    eventImageInput.addEventListener('change', (ev) => {
      const file = ev.target.files && ev.target.files[0];
      if (!file) { previewImg.src=''; addPreview.style.display='none'; currentImageData = null; return; }
      const reader = new FileReader();
      reader.onload = (e) => {
        currentImageData = e.target.result;
        previewImg.src = currentImageData;
        addPreview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    });

    saveEventBtn.addEventListener('click', () => {
      // collect fields & validate
      const datetime = eventDatetimeInput.value.trim();
      const p1 = eventP1.value.trim();
      const p2 = eventP2.value.trim();
      const p3 = eventP3.value.trim();

      const existing = readStoredEvents();
      if (existing.length >= 3) {
        alert('Maximum of 3 events reached. Clear or remove events to add more.');
        return;
      }
      if (!currentImageData){
        // allow empty image? we'll require for better UX
        if (!confirm('No image uploaded. Continue without an image?')) return;
      }
      if (!datetime || !p1){
        alert('Please provide at least a date/time and the first point.');
        return;
      }

      const newEv = {
        image: currentImageData || '',
        datetime: datetime,
        points: [p1, p2||'', p3||''],
        color: pickRandomColor()
      };
      existing.push(newEv);
      saveStoredEvents(existing);
      renderEvents();
      hideAddForm();
    });

    // CLEAR EVENTS
    clearEventsBtn.addEventListener('click', () => {
      if (!confirm('Clear all events? This cannot be undone.')) return;
      clearStoredEvents();
      renderEvents();
      // hide form if open
      hideAddForm();
    });

    // ensure render when page loads
    window.addEventListener('load', () => {
      renderEvents();
    });

    /**********************
     * Safety / logging
     **********************/
    window.addEventListener('error', (e)=> {
      console.error('Runtime error:', e.message, 'at', e.filename+':'+e.lineno);
    });

  </script>
</body>
</html>


